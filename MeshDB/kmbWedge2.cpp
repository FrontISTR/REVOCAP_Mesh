/*----------------------------------------------------------------------
#                                                                      #
# Software Name : REVOCAP_PrePost version 1.6                          #
# Class Name : Wedge2                                                  #
#                                                                      #
#                                Written by                            #
#                                           K. Tokunaga 2012/03/23     #
#                                                                      #
#      Contact Address: IIS, The University of Tokyo CISS              #
#                                                                      #
#      "Large Scale Assembly, Structural Correspondence,               #
#                                     Multi Dynamics Simulator"        #
#                                                                      #
# Software Name : RevocapMesh version 1.2                              #
#                                                                      #
#                                Written by                            #
#                                           K. Tokunaga 2008/03/14     #
#                                           T. Takeda   2008/03/14     #
#                                           K. Amemiya  2008/03/14     #
#                                                                      #
#      Contact Address: RSS21 Project, IIS, The University of Tokyo    #
#                                                                      #
#      "Innovative General-Purpose Coupled Analysis System"            #
#                                                                      #
----------------------------------------------------------------------*/
#include "MeshDB/kmbWedge2.h"

#include "MeshDB/kmbTetrahedron.h"
#include "MeshDB/kmbWedge.h"
#include "MeshDB/kmbMeshData.h"
#include "MeshDB/kmbElementRelation.h"

/********************************************************************************
=begin

=== 2ŽŸŽOŠp’Œ—v‘f (WEDGE2)

Ú‘±s—ñ

	{ 0, 1, 1, 1, 0, 0, 0, 2, 2, 0, 0, 0, 2, 0, 0},
	{ 1, 0, 1, 0, 1, 0, 2, 0, 2, 0, 0, 0, 0, 2, 0},
	{ 1, 1, 0, 0, 0, 1, 2, 2, 0, 0, 0, 0, 0, 0, 2},
	{ 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 2, 2, 2, 0, 0},
	{ 0, 1, 0, 1, 0, 1, 0, 0, 0, 2, 0, 2, 0, 2, 0},
	{ 0, 0, 1, 1, 1, 0, 0, 0, 0, 2, 2, 0, 0, 0, 2},
	{ 0, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 0, 0, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 2, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 0, 2, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 0, 0, 2, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0}

–Êî•ñ

	{ 0, 2, 1, 6, 8, 7},
	{ 3, 4, 5, 9,10,11},
	{ 0, 1, 4, 3, 8,13,11,12},
	{ 1, 2, 5, 4, 6,14, 9,13},
	{ 2, 0, 3, 5, 7,12,10,14}

•Ó

	{ 1, 2, 6},
	{ 0, 2, 7},
	{ 0, 1, 8},
	{ 4, 5, 9},
	{ 3, 5, 10},
	{ 3, 4, 11},
	{ 0, 3, 12},
	{ 1, 4, 13},
	{ 2, 5, 14}

=end

Œ`óŠÖ” serendipity
0 : 1/2*(1-s-t)*(1-2*s-2*t)*u*(u-1)       => (s,t,u) = ( 0, 0,-1)
1 : 1/2*s*(2*s-1)*u*(u-1)                 => (s,t,u) = ( 1, 0,-1)
2 : 1/2*t*(2*t-1)*u*(u-1)                 => (s,t,u) = ( 0, 1,-1)
3 : 1/2*(1-s-t)*(1-2*s-2*t)*u*(u+1)       => (s,t,u) = ( 0, 0, 1)
4 : 1/2*s*(2*s-1)*u*(u+1)                 => (s,t,u) = ( 1, 0, 1)
5 : 1/2*t*(2*t-1)*u*(u+1)                 => (s,t,u) = ( 0, 1, 1)
6 : 2*s*t*u*(u-1)                         => (s,t,u) = ( 0.5, 0.5, -1)
7 : 2*t*(1-s-t)*u*(u-1)                   => (s,t,u) = (   0, 0.5, -1)
8 : 2*s*(1-s-t)*u*(u-1)                   => (s,t,u) = ( 0.5,   0, -1)
9 : 2*s*t*u*(u+1)                         => (s,t,u) = ( 0.5, 0.5,  1)
10: 2*t*(1-s-t)*u*(u+1)                   => (s,t,u) = (   0, 0.5,  1)
11: 2*s*(1-s-t)*u*(u+1)                   => (s,t,u) = ( 0.5,   0,  1)
12: (1-s-t)*(1-u*u)                       => (s,t,u) = (   0,   0,  0)
13: s*(1-u*u)                             => (s,t,u) = (   1,   0,  0)
14: t*(1-u*u)                             => (s,t,u) = (   0,   1,  0)

0 : 1/2*(1-s-t)*(u-1)*(2s+2t+u)           => (s,t,u) = ( 0, 0,-1)
1 : 1/2*s*(u-1)*(2-2s+u)                  => (s,t,u) = ( 1, 0,-1)
2 : 1/2*t*(u-1)*(2-2t+u)                  => (s,t,u) = ( 0, 1,-1)
3 : 1/2*(1-s-t)*(u+1)*(u-2s-2t)           => (s,t,u) = ( 0, 0, 1)
4 : 1/2*s*(u+1)*(u+2s-2)                  => (s,t,u) = ( 1, 0, 1)
5 : 1/2*t*(u+1)*(u+2t-2)                  => (s,t,u) = ( 0, 1, 1)
6 : 2*s*t*(1-u)                           => (s,t,u) = ( 0.5, 0.5, -1)
7 : 2*t*(1-s-t)*(1-u)                     => (s,t,u) = (   0, 0.5, -1)
8 : 2*s*(1-s-t)*(1-u)                     => (s,t,u) = ( 0.5,   0, -1)
9 : 2*s*t*(1+u)                           => (s,t,u) = ( 0.5, 0.5,  1)
10: 2*t*(1-s-t)*(1+u)                     => (s,t,u) = (   0, 0.5,  1)
11: 2*s*(1-s-t)*(1+u)                     => (s,t,u) = ( 0.5,   0,  1)
12: (1-s-t)*(1-u*u)                       => (s,t,u) = (   0,   0,  0)
13: s*(1-u*u)                             => (s,t,u) = (   1,   0,  0)
14: t*(1-u*u)                             => (s,t,u) = (   0,   1,  0)

*********************************************************************************/
const int kmb::Wedge2::nodeCount = 15;

const int kmb::Wedge2::connectionTable[15][15] =
{
	{ 0, 1, 1, 1, 0, 0, 0, 2, 2, 0, 0, 0, 2, 0, 0},
	{ 1, 0, 1, 0, 1, 0, 2, 0, 2, 0, 0, 0, 0, 2, 0},
	{ 1, 1, 0, 0, 0, 1, 2, 2, 0, 0, 0, 0, 0, 0, 2},
	{ 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 2, 2, 2, 0, 0},
	{ 0, 1, 0, 1, 0, 1, 0, 0, 0, 2, 0, 2, 0, 2, 0},
	{ 0, 0, 1, 1, 1, 0, 0, 0, 0, 2, 2, 0, 0, 0, 2},
	{ 0, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 0, 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 0, 0, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 0, 0, 0, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 2, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 0, 2, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
	{ 0, 0, 2, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0}
};





const int kmb::Wedge2::faceTable[5][8] =
{
	{ 0, 2, 1, 6, 8, 7,-1,-1},
	{ 3, 4, 5, 9,10,11,-1,-1},
	{ 0, 1, 4, 3, 8,13,11,12},
	{ 1, 2, 5, 4, 6,14, 9,13},
	{ 2, 0, 3, 5, 7,12,10,14}
};

const int kmb::Wedge2::edgeTable[9][3] =
{
	{ 1, 2, 6},
	{ 0, 2, 7},
	{ 0, 1, 8},
	{ 4, 5, 9},
	{ 3, 5, 10},
	{ 3, 4, 11},
	{ 0, 3, 12},
	{ 1, 4, 13},
	{ 2, 5, 14}
};

kmb::Wedge2::Wedge2(void)
: kmb::Element(kmb::WEDGE2)
{
	cell = new kmb::nodeIdType[15];
}

kmb::Wedge2::Wedge2(kmb::nodeIdType* ary)
: kmb::Element(kmb::WEDGE2)
{
	cell = ary;
}

kmb::Wedge2::~Wedge2(void)
{
}

void
kmb::Wedge2::shapeFunction(double s,double t,double u,double* coeff)
{
/*
	coeff[0] = 0.5*(1.0-s-t)*(1.0-2.0*s-2.0*t)*u*(u-1.0);
	coeff[1] = 0.5*s*(2.0*s-1.0)*u*(u-1.0);
	coeff[2] = 0.5*t*(2.0*t-1.0)*u*(u-1.0);
	coeff[3] = 0.5*(1.0-s-t)*(1.0-2.0*s-2.0*t)*u*(u+1.0);
	coeff[4] = 0.5*s*(2.0*s-1.0)*u*(u+1.0);
	coeff[5] = 0.5*t*(2.0*t-1.0)*u*(u+1.0);
	coeff[6] = 2.0*s*t*u*(u-1.0);
	coeff[7] = 2.0*t*(1.0-s-t)*u*(u-1.0);
	coeff[8] = 2.0*s*(1.0-s-t)*u*(u-1.0);
	coeff[9] = 2.0*s*t*u*(u+1.0);
	coeff[10] = 2.0*t*(1.0-s-t)*u*(u+1.0);
	coeff[11] = 2.0*s*(1.0-s-t)*u*(u+1.0);
	coeff[12] = (1.0-s-t)*(1.0-u*u);
	coeff[13] = s*(1.0-u*u);
	coeff[14] = t*(1.0-u*u);
*/
	coeff[0] = 0.5*(1.0-s-t)*(u-1.0)*(2.0*s+2.0*t+u);
	coeff[1] = 0.5*s*(u-1.0)*(2.0-2.0*s+u);
	coeff[2] = 0.5*t*(u-1.0)*(2.0-2.0*t+u);
	coeff[3] = 0.5*(1.0-s-t)*(u+1.0)*(u-2.0*s-2.0*t);
	coeff[4] = 0.5*s*(u+1.0)*(u+2.0*s-2.0);
	coeff[5] = 0.5*t*(u+1.0)*(u+2.0*t-2.0);
	coeff[6] = 2.0*s*t*(1.0-u);
	coeff[7] = 2.0*t*(1.0-s-t)*(1.0-u);
	coeff[8] = 2.0*s*(1.0-s-t)*(1.0-u);
	coeff[9] = 2.0*s*t*(1.0+u);
	coeff[10] = 2.0*t*(1.0-s-t)*(1.0+u);
	coeff[11] = 2.0*s*(1.0-s-t)*(1.0+u);
	coeff[12] = (1.0-s-t)*(1.0-u*u);
	coeff[13] = s*(1.0-u*u);
	coeff[14] = t*(1.0-u*u);
}

double
kmb::Wedge2::checkShapeFunctionDomain(double s,double t,double u)
{

	kmb::Minimizer minimizer;
	minimizer.update( s );
	minimizer.update( t );
	minimizer.update( 1.0-s-t );
	minimizer.update( 1.0-u );
	minimizer.update( 1.0+u );
	return minimizer.getMin();
}
